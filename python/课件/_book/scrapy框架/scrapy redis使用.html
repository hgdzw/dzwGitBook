<!DOCTYPE HTML>
<html lang="zh-hans" >
    <!-- Start book 爬虫课程 -->
    <head>
        <!-- head:start -->
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>scrapy redis使用 | 爬虫课程</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        <meta name="author" content="zhuwei">
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-splitter/splitter.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-prism/prism-solarizedlight.css">
        
    
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-sectionx/sectionx.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-ace/ace.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-emphasize/plugin.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-toggle-chapters/toggle.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-codeblock-filename/block.css">
        
    
    
        <link rel="stylesheet" href="../styles/website.css">
    

        
    
    
    <link rel="next" href="../附录/附录.html" />
    
    
    <link rel="prev" href="../scrapy框架/scrapy项目部署.html" />
    

        <!-- head:end -->
    </head>
    <body>
        <!-- body:start -->
        
    <div class="book"
        data-level="6.4"
        data-chapter-title="scrapy redis使用"
        data-filepath="scrapy框架/scrapy redis使用.md"
        data-basepath=".."
        data-revision="Mon Feb 11 2019 22:53:05 GMT+0800 (CST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        爬虫课程介绍
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="爬虫预备知识/爬虫预备知识.html">
            
                
                    <a href="../爬虫预备知识/爬虫预备知识.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        爬虫预备知识
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="爬虫预备知识/爬虫定义、分类和流程.html">
            
                
                    <a href="../爬虫预备知识/爬虫定义、分类和流程.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        爬虫定义、分类和流程
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="爬虫预备知识/http和https的复习.html">
            
                
                    <a href="../爬虫预备知识/http和https的复习.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        http和https的复习
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="网络数据获取/网络数据获取.html">
            
                
                    <a href="../网络数据获取/网络数据获取.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        网络数据获取
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="网络数据获取/请求分析流程.html">
            
                
                    <a href="../网络数据获取/请求分析流程.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        请求分析流程
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="网络数据获取/requests模块介绍与使用.html">
            
                
                    <a href="../网络数据获取/requests模块介绍与使用.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        requests 模块
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="数据提取/数据提取.html">
            
                
                    <a href="../数据提取/数据提取.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        数据提取
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="数据提取/数据提取概念和数据的分类.html">
            
                
                    <a href="../数据提取/数据提取概念和数据的分类.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        数据提取概念和数据的分类
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="数据提取/JSON数据提取.html">
            
                
                    <a href="../数据提取/JSON数据提取.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        JSON 与 jsonpath 数据提取
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="数据提取/使用正则表达式提取数据.html">
            
                
                    <a href="../数据提取/使用正则表达式提取数据.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        正则表达式 数据提取
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="数据提取/xpath数据提取.html">
            
                
                    <a href="../数据提取/xpath数据提取.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        html/xml 与 xpath 数据提取
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="数据提取/bs4数据提取.html">
            
                
                    <a href="../数据提取/bs4数据提取.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        beautifulsoup 数据提取
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="数据提取/csv数据转换.html">
            
                
                    <a href="../数据提取/csv数据转换.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        json、csv 数据转换
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="高级技巧/高级技巧.html">
            
                
                    <a href="../高级技巧/高级技巧.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        高级技巧
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="高级技巧/高性能爬虫.html">
            
                
                    <a href="../高级技巧/高性能爬虫.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        高性能爬虫
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="高级技巧/selenium.html">
            
                
                    <a href="../高级技巧/selenium.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        selenium
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="高级技巧/打码平台.html">
            
                
                    <a href="../高级技巧/打码平台.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        打码平台
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="高级技巧/tesseract.html">
            
                
                    <a href="../高级技巧/tesseract.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        tesseract OCR识别
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="高级技巧/代理池.html">
            
                
                    <a href="../高级技巧/代理池.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        代理池
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="高级技巧/常见反扒手段.html">
            
                
                    <a href="../高级技巧/常见反扒手段.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        常见反扒手段
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="数据保存/数据保存.html">
            
                
                    <a href="../数据保存/数据保存.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        数据保存
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="数据保存/mongodb.html">
            
                
                    <a href="../数据保存/mongodb.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        mongodb
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="scrapy框架/scrapy框架.html">
            
                
                    <a href="../scrapy框架/scrapy框架.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        scrapy框架
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="scrapy框架/scrapy基本使用.html">
            
                
                    <a href="../scrapy框架/scrapy基本使用.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        scrapy 基本使用
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="scrapy框架/scrapy高级使用.html">
            
                
                    <a href="../scrapy框架/scrapy高级使用.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        scrapy 高级使用
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="scrapy框架/scrapy项目部署.html">
            
                
                    <a href="../scrapy框架/scrapy项目部署.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                        scrapy 项目部署
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="6.4" data-path="scrapy框架/scrapy redis使用.html">
            
                
                    <a href="../scrapy框架/scrapy redis使用.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.4.</b>
                        
                        scrapy redis使用
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="附录/附录.html">
            
                
                    <a href="../附录/附录.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        附录
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="附录/HTTP请求列表.html">
            
                
                    <a href="../附录/HTTP请求列表.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        HTTP请求列表
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="附录/HTTP响应列表.html">
            
                
                    <a href="../附录/HTTP响应列表.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.</b>
                        
                        HTTP响应列表
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    本书使用 GitBook 发布
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >爬虫课程</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <html><head></head><body><h1 id="scrapy-redis&#x4F7F;&#x7528;">scrapy redis&#x4F7F;&#x7528;</h1>
<sec data-title="&#x5B66;&#x4E60;&#x76EE;&#x6807;" data-id="section0" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><h2>&#x5B66;&#x4E60;&#x76EE;&#x6807;<a class="pull-right section atTitle btn btn-default" target="section0"><span class="fa fa-angle-up"></span></a></h2></div><div class="panel-collapse in" id="section0"><div class="panel-body">
<ul>
<li><strong>&#x3010;&#x638C;&#x63E1;&#x3011;</strong> &#x4F7F;&#x7528; <code>scrapy redis</code> &#x5B9E;&#x73B0;&#x65AD;&#x70B9;&#x7EED;&#x722C;</li>
<li><strong>&#x3010;&#x638C;&#x63E1;&#x3011;</strong> &#x4F7F;&#x7528; <code>scrapy redis</code> &#x5206;&#x5E03;&#x5F0F;&#x722C;&#x866B; </li>
</ul>
</div></div></div></sec>
<sec data-title="scrapy redis &#x4ECB;&#x7ECD;&#x4E0E;&#x57FA;&#x672C;&#x4F7F;&#x7528;" data-id="section01" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><h2>scrapy redis &#x4ECB;&#x7ECD;&#x4E0E;&#x57FA;&#x672C;&#x4F7F;&#x7528;<a class="pull-right section atTitle btn btn-default" target="section01"><span class="fa fa-angle-up"></span></a></h2></div><div class="panel-collapse in" id="section01"><div class="panel-body">
<h4 id="&#x4ECB;&#x7ECD;">&#x4ECB;&#x7ECD;</h4>
<blockquote>
<p><code>scrapy redis</code> &#x5229;&#x7528; scrapy + redis &#x5B9E;&#x73B0;&#x4E00;&#x4E0B;&#x529F;&#x80FD;</p>
</blockquote>
<h4 id="&#x5B9E;&#x73B0;&#x529F;&#x80FD;">&#x5B9E;&#x73B0;&#x529F;&#x80FD;</h4>
<ul>
<li>&#x65AD;&#x70B9;&#x7EED;&#x722C;&#x529F;&#x80FD;</li>
<li>&#x5B9E;&#x73B0;&#x5206;&#x5E03;&#x5F0F;&#x722C;&#x866B;&#x529F;&#x80FD;</li>
</ul>
<h4 id="&#x5B89;&#x88C5;">&#x5B89;&#x88C5;</h4>
<pre><code class="lang-bash">pip <span class="token function">install</span> scrapy-redis
</code></pre>
<h4 id="&#x65AD;&#x70B9;&#x7EED;&#x722C;&#x5B9E;&#x73B0;&#x6D41;&#x7A0B;">&#x65AD;&#x70B9;&#x7EED;&#x722C;&#x5B9E;&#x73B0;&#x6D41;&#x7A0B;</h4>
<p><img src="../images/scrapy-redis&#x65AD;&#x70B9;&#x7EED;&#x722C;&#x6D41;&#x7A0B;&#x56FE;.png" alt=""></p>
<h4 id="&#x65AD;&#x70B9;&#x7EED;&#x722C;&#x5B9E;&#x73B0;">&#x65AD;&#x70B9;&#x7EED;&#x722C;&#x5B9E;&#x73B0;</h4>
<blockquote>
<p>&#x5728; <code>settings.py</code> &#x914D;&#x7F6E;</p>
</blockquote>
<pre><code class="lang-python"><span class="token comment"># &#x628A;&#x539F;&#x6765;&#x7684;&#x8BF7;&#x6C42;&#x8C03;&#x5EA6;&#x5668;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x6539;&#x9020;&#x6210;redis&#x7684;&#x5B9E;&#x73B0;&#x7C7B;</span>
SCHEDULER <span class="token operator">=</span> <span class="token string">&quot;scrapy_redis.scheduler.Scheduler&quot;</span>

<span class="token comment"># &#x8BBE;&#x7F6E;&#x53BB;&#x91CD;&#x7B97;&#x6CD5;</span>
DUPEFILTER_CLASS <span class="token operator">=</span> <span class="token string">&quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;</span>

<span class="token comment"># &#x5F00;&#x5173;&#x5F00;&#x542F;&#x6301;&#x4E45;&#x5316;</span>
SCHEDULER_PERSIST <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token comment"># &#x914D;&#x7F6E;redis&#x670D;&#x52A1;&#x5668;</span>
<span class="token comment">#</span>
<span class="token comment"># REDIS_URL = &quot;redis://127.0.0.1:6379&quot;</span>
<span class="token comment">#&#x6216;&#x8005;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x65B9;&#x5F0F;</span>
<span class="token comment"># REDIS_HOST = &quot;127.0.0.1&quot;</span>
<span class="token comment"># REDIS_PORT = 6379</span>
</code></pre>
<h4 id="&#x53BB;&#x91CD;&#x539F;&#x7406;">&#x53BB;&#x91CD;&#x539F;&#x7406;</h4>
<blockquote>
<p>sha1(&#x8BF7;&#x6C42;&#x65B9;&#x5F0F;) + sha1(&#x53C2;&#x6570;&#x6392;&#x5E8F;&#x540E;&#x7684;&#x8BF7;&#x6C42;url) + sha1(&#x8BF7;&#x6C42;&#x4F53;)</p>
</blockquote>
<h4 id="&#x5206;&#x5E03;&#x5F0F;&#x722C;&#x866B;&#x5B9E;&#x73B0;&#x6D41;&#x7A0B;">&#x5206;&#x5E03;&#x5F0F;&#x722C;&#x866B;&#x5B9E;&#x73B0;&#x6D41;&#x7A0B;</h4>
<p><img src="../images/scrapy-redis&#x5206;&#x5E03;&#x5F0F;&#x722C;&#x866B;&#x6D41;&#x7A0B;.jpg" alt=""></p>
<h4 id="&#x5206;&#x5E03;&#x5F0F;&#x722C;&#x866B;&#x5B9E;&#x73B0;">&#x5206;&#x5E03;&#x5F0F;&#x722C;&#x866B;&#x5B9E;&#x73B0;</h4>
<ol>
<li><p>&#x5728; <code>settings.py</code> &#x4E2D;&#x914D;&#x7F6E;</p>
<pre><code class="lang-python"><span class="token comment"># &#x628A;&#x539F;&#x6765;&#x7684;&#x8BF7;&#x6C42;&#x8C03;&#x5EA6;&#x5668;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x6539;&#x9020;&#x6210;redis&#x7684;&#x5B9E;&#x73B0;&#x7C7B;</span>
SCHEDULER <span class="token operator">=</span> <span class="token string">&quot;scrapy_redis.scheduler.Scheduler&quot;</span>

<span class="token comment"># &#x8BBE;&#x7F6E;&#x53BB;&#x91CD;&#x7B97;&#x6CD5;</span>
DUPEFILTER_CLASS <span class="token operator">=</span> <span class="token string">&quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;</span>

<span class="token comment"># &#x5F00;&#x5173;&#x5F00;&#x542F;&#x6301;&#x4E45;&#x5316;</span>
SCHEDULER_PERSIST <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token comment"># &#x914D;&#x7F6E;redis&#x670D;&#x52A1;&#x5668;</span>
<span class="token comment">#</span>
<span class="token comment"># REDIS_URL = &quot;redis://127.0.0.1:6379&quot;</span>
<span class="token comment">#&#x6216;&#x8005;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x65B9;&#x5F0F;</span>
<span class="token comment"># REDIS_HOST = &quot;&#x76EE;&#x6807;redis&#x670D;&#x52A1;&#x5668;&quot; # &#x4E0D;&#x80FD;&#x7F16;&#x5199; 127.0.0.1</span>
<span class="token comment"># REDIS_PORT = 6379</span>

<span class="token comment"># &#x7BA1;&#x9053;&#x914D;&#x7F6E;</span>
ITEM_PIPELINES <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token string">&apos;scrapy_redis.pipelines.RedisPipeline&apos;</span><span class="token punctuation">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
</li>
<li><p>&#x4FEE;&#x6539;&#x722C;&#x866B;&#x4EE3;&#x7801;,&#x4FEE;&#x6539;&#x7EE7;&#x627F;&#x7C7B;</p>
<ul>
<li>CrawlSpider =&gt; RedisCrawlSpider</li>
<li>Spider =&gt; RedisSpider</li>
</ul>
</li>
<li><p>&#x6DFB;&#x52A0;&#x76D1;&#x89C6;&#x7684; <code>redis_key</code> &#x63D0;&#x4F9B;&#x9996;&#x4E2A;&#x8BF7;&#x6C42;&#x5730;&#x5740; </p>
</li>
</ol>
</div></div></div></sec>
<sec data-title="&#x56FE;&#x4E66;&#x9879;&#x76EE; &#x4E4B; &#x4EAC;&#x4E1C;&#x56FE;&#x4E66;&#x722C;&#x866B;" data-id="section02" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><h2>&#x56FE;&#x4E66;&#x9879;&#x76EE; &#x4E4B; &#x4EAC;&#x4E1C;&#x56FE;&#x4E66;&#x722C;&#x866B;<a class="pull-right section atTitle btn btn-default" target="section02"><span class="fa fa-angle-up"></span></a></h2></div><div class="panel-collapse in" id="section02"><div class="panel-body">
<h4 id="&#x76EE;&#x6807;&#x5730;&#x5740;">&#x76EE;&#x6807;&#x5730;&#x5740;</h4>
<p><a href="https://book.jd.com/booksort.html" target="_blank">https://book.jd.com/booksort.html</a></p>
<h4 id="&#x722C;&#x53D6;&#x6D41;&#x7A0B;">&#x722C;&#x53D6;&#x6D41;&#x7A0B;</h4>
<ol>
<li>&#x83B7;&#x53D6;&#x5206;&#x7C7B;&#x9875;url</li>
<li>&#x83B7;&#x53D6;&#x5217;&#x8868;&#x9875;&#x5185;&#x5BB9;&#xFF0C;&#x4ECE;&#x4E2D;&#x63D0;&#x53D6;&#x56FE;&#x4E66;&#x540D;&#x79F0;&#x548C;&#x4EF7;&#x683C;<ol>
<li>&#x56FE;&#x4E66;&#x540D;&#x79F0;&#x76F4;&#x63A5;&#x63D0;&#x53D6;</li>
<li>&#x901A;&#x8FC7;&#x8BF7;&#x6C42;&#x5206;&#x6790;&#x83B7;&#x53D6;&#x4EF7;&#x683C;</li>
</ol>
</li>
<li>&#x5B9E;&#x73B0;&#x4EF7;&#x683C;&#x63D0;&#x53D6;</li>
</ol>
<h4 id="&#x5B9E;&#x73B0;&#x4EE3;&#x7801;">&#x5B9E;&#x73B0;&#x4EE3;&#x7801;</h4>
<pre><code class="lang-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">import</span> scrapy
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse
<span class="token keyword">import</span> json
<span class="token keyword">from</span> book<span class="token punctuation">.</span>settings <span class="token keyword">import</span> IS_DEVELOPMENT
<span class="token keyword">if</span> IS_DEVELOPMENT<span class="token punctuation">:</span>
    <span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>spiders <span class="token keyword">import</span> Spider
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">from</span> scrapy_redis<span class="token punctuation">.</span>spiders <span class="token keyword">import</span> RedisSpider <span class="token keyword">as</span> Spider

<span class="token keyword">from</span> book<span class="token punctuation">.</span>items <span class="token keyword">import</span> BookItem

<span class="token keyword">class</span> <span class="token class-name">JdSpider</span><span class="token punctuation">(</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">&apos;jd&apos;</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&apos;jd.com&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;3.cn&apos;</span><span class="token punctuation">]</span>
    redis_key <span class="token operator">=</span> <span class="token string">&quot;book:jd:start_urls&quot;</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&apos;https://book.jd.com/booksort.html&apos;</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># &#x89E3;&#x6790;&#x5206;&#x7C7B;&#x9875;&#xFF0C;&#x63D0;&#x53D6;&#x5217;&#x8868;&#x9875;url&#x5730;&#x5740;</span>
        cate_1_titles <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;//div[@class=&quot;mc&quot;]/dl/dt/a/text()&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>
        dd_list <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;//div[@class=&quot;mc&quot;]/dl/dd&apos;</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> cate_1_title<span class="token punctuation">,</span>dd <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>cate_1_titles<span class="token punctuation">,</span>dd_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
            cate_2_titles <span class="token operator">=</span> dd<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;./em/a/text()&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>
            cate_2_hrefs <span class="token operator">=</span> dd<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;./em/a/@href&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> cate_2_title<span class="token punctuation">,</span>cate_2_href <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>cate_2_titles<span class="token punctuation">,</span>cate_2_hrefs<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>cate_1_title<span class="token punctuation">,</span><span class="token string">&apos;=&gt;&apos;</span><span class="token punctuation">,</span>cate_2_title<span class="token punctuation">,</span><span class="token string">&apos;=&gt;&apos;</span><span class="token punctuation">,</span>cate_2_href<span class="token punctuation">)</span>
                <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>
                    url<span class="token operator">=</span><span class="token string">&quot;https:&quot;</span> <span class="token operator">+</span> cate_2_href<span class="token punctuation">,</span>
                    callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_list
                <span class="token punctuation">)</span>
        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">parse_list</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        li_list <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;//ul[@class=&quot;gl-warp clearfix&quot;]/li&apos;</span><span class="token punctuation">)</span>
        skuIds <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
        items <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> li <span class="token keyword">in</span> li_list<span class="token punctuation">:</span>
            item <span class="token operator">=</span> BookItem<span class="token punctuation">(</span><span class="token punctuation">)</span>
            item<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;.//div[@class=&quot;p-name&quot;]//em/text()&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            data_sku <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;.//div/@data-sku&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>
            sku_id_string <span class="token operator">=</span> <span class="token string">&quot;J_&quot;</span><span class="token operator">+</span>data_sku
            items<span class="token punctuation">[</span>sku_id_string<span class="token punctuation">]</span> <span class="token operator">=</span> item
            skuIds <span class="token operator">=</span> skuIds <span class="token operator">+</span> sku_id_string <span class="token operator">+</span><span class="token string">&quot;,&quot;</span>

        <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>
            url<span class="token operator">=</span><span class="token string">&quot;https://p.3.cn/prices/mgets?skuIds=&quot;</span><span class="token operator">+</span>urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>skuIds<span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">&quot;&amp;pduid=1524873229287521206013&quot;</span><span class="token punctuation">,</span>
            callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_prices<span class="token punctuation">,</span>
            meta<span class="token operator">=</span><span class="token punctuation">{</span>
                <span class="token string">&quot;items&quot;</span><span class="token punctuation">:</span>items
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        <span class="token comment"># &#x4E0B;&#x4E00;&#x9875;</span>
        next_url <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;//a[@class=&quot;pn-next&quot;]/@href&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> next_url <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>
                url<span class="token operator">=</span><span class="token string">&quot;https://list.jd.com&quot;</span> <span class="token operator">+</span> next_url<span class="token punctuation">,</span>
                callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_list
            <span class="token punctuation">)</span>
        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">parse_prices</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        items <span class="token operator">=</span> response<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">&quot;items&quot;</span><span class="token punctuation">]</span>
        results <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        <span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">:</span>
            item <span class="token operator">=</span> items<span class="token punctuation">[</span>result<span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
            item<span class="token punctuation">[</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">&quot;op&quot;</span><span class="token punctuation">]</span>
            <span class="token keyword">yield</span> item
</code></pre>
</div></div></div></sec>
<sec data-title="&#x56FE;&#x4E66;&#x9879;&#x76EE; &#x4E4B; &#x4E9A;&#x9A6C;&#x900A;&#x56FE;&#x4E66;&#x722C;&#x866B;" data-id="section03" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><h2>&#x56FE;&#x4E66;&#x9879;&#x76EE; &#x4E4B; &#x4E9A;&#x9A6C;&#x900A;&#x56FE;&#x4E66;&#x722C;&#x866B;<a class="pull-right section atTitle btn btn-default" target="section03"><span class="fa fa-angle-up"></span></a></h2></div><div class="panel-collapse in" id="section03"><div class="panel-body">
<h4 id="&#x722C;&#x53D6;&#x6D41;&#x7A0B;">&#x722C;&#x53D6;&#x6D41;&#x7A0B;</h4>
<ol>
<li>1&#x7EA7;&#x5206;&#x7C7B;&#x63D0;&#x53D6;&#x8DDF;&#x8FDB;</li>
<li>2&#x7EA7;&#x5206;&#x7C7B;&#x63D0;&#x53D6;&#x8DDF;&#x8FDB;</li>
<li>3&#x7EA7;&#x5206;&#x7C7B;&#x63D0;&#x53D6;&#x8DDF;&#x8FDB;</li>
<li>&#x4E0B;&#x4E00;&#x9875;&#x8DDF;&#x8FDB;</li>
<li>&#x63D0;&#x53D6;&#x5217;&#x8868;&#x9875;&#x8DDF;&#x8FDB;&#xFF0C;&#x5E76;&#x4E14;&#x89E3;&#x6790;&#x8DDF;&#x8FDB;&#x540E;&#x8BE6;&#x60C5;&#x9875; </li>
</ol>
<h4 id="&#x5B9E;&#x73B0;&#x4EE3;&#x7801;">&#x5B9E;&#x73B0;&#x4EE3;&#x7801;</h4>
<pre><code class="lang-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">import</span> scrapy
<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>linkextractors <span class="token keyword">import</span> LinkExtractor
<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>spiders <span class="token keyword">import</span> Rule

<span class="token keyword">from</span> book<span class="token punctuation">.</span>settings <span class="token keyword">import</span> IS_DEVELOPMENT

<span class="token keyword">if</span> IS_DEVELOPMENT<span class="token punctuation">:</span>
    <span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>spiders <span class="token keyword">import</span> CrawlSpider
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">from</span> scrapy_redis<span class="token punctuation">.</span>spiders <span class="token keyword">import</span> RedisCrawlSpider <span class="token keyword">as</span> CrawlSpider

<span class="token keyword">from</span> book<span class="token punctuation">.</span>items <span class="token keyword">import</span> BookItem
<span class="token keyword">class</span> <span class="token class-name">AmazonSpider</span><span class="token punctuation">(</span>CrawlSpider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">&apos;amazon&apos;</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&apos;amazon.cn&apos;</span><span class="token punctuation">]</span>
    redis_key <span class="token operator">=</span> <span class="token string">&quot;book:amazon:start_urls&quot;</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&apos;https://www.amazon.cn/&#x56FE;&#x4E66;/b/ref=sa_menu_top_books_l1?ie=UTF8&amp;node=658390051&apos;</span><span class="token punctuation">]</span>
    <span class="token triple-quoted-string string">&apos;&apos;&apos;
    &#x722C;&#x53D6;&#x6D41;&#x7A0B;
    1. 1&#x7EA7;&#x5206;&#x7C7B;&#x63D0;&#x53D6;&#x8DDF;&#x8FDB;
    2. 2&#x7EA7;&#x5206;&#x7C7B;&#x63D0;&#x53D6;&#x8DDF;&#x8FDB;
    3. 3&#x7EA7;&#x5206;&#x7C7B;&#x63D0;&#x53D6;&#x8DDF;&#x8FDB;
    4. &#x4E0B;&#x4E00;&#x9875;&#x8DDF;&#x8FDB;
    5. &#x63D0;&#x53D6;&#x5217;&#x8868;&#x9875;&#x8DDF;&#x8FDB;&#xFF0C;&#x5E76;&#x4E14;&#x89E3;&#x6790;&#x8DDF;&#x8FDB;&#x540E;&#x8BE6;&#x60C5;&#x9875;   
    &apos;&apos;&apos;</span>

    cate_1_le <span class="token operator">=</span> LinkExtractor<span class="token punctuation">(</span>
        restrict_xpaths<span class="token operator">=</span><span class="token punctuation">(</span>
            <span class="token string">&apos;//ul[@class=&quot;a-unordered-list a-nostyle a-vertical s-ref-indent-one&quot;]//a[@class=&quot;a-link-normal s-ref-text-link&quot;]&apos;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    cate_2_3_le <span class="token operator">=</span> LinkExtractor<span class="token punctuation">(</span>
        restrict_xpaths<span class="token operator">=</span><span class="token punctuation">(</span>
            <span class="token string">&apos;//ul[@class=&quot;a-unordered-list a-nostyle a-vertical s-ref-indent-two&quot;]//a[@class=&quot;a-link-normal s-ref-text-link&quot;]&apos;</span>
       <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    detail_le <span class="token operator">=</span> LinkExtractor<span class="token punctuation">(</span>
        restrict_xpaths<span class="token operator">=</span><span class="token punctuation">(</span>
            <span class="token string">&apos;//div[@class=&quot;a-column a-span12 a-text-center&quot;]//a[@class=&quot;a-link-normal a-text-normal&quot;]&apos;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    next_le <span class="token operator">=</span> LinkExtractor<span class="token punctuation">(</span>
        restrict_xpaths<span class="token operator">=</span><span class="token punctuation">(</span>
            <span class="token string">&apos;//a[@id=&quot;pagnNextLink&quot;]&apos;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    rules <span class="token operator">=</span> <span class="token punctuation">(</span>
        Rule<span class="token punctuation">(</span>cate_1_le<span class="token punctuation">,</span> follow<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Rule<span class="token punctuation">(</span>cate_2_3_le<span class="token punctuation">,</span> follow<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Rule<span class="token punctuation">(</span>next_le<span class="token punctuation">,</span> follow<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Rule<span class="token punctuation">(</span>detail_le<span class="token punctuation">,</span>follow<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>callback<span class="token operator">=</span><span class="token string">&quot;parse_detail&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">parse_detail</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        name <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;//span[@id=&quot;productTitle&quot;]/text()&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> name <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            name <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;//span[@id=&quot;ebooksProductTitle&quot;]/text()&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>
        price <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token comment"># &#x63D0;&#x53D6;&#x4EF7;&#x683C;</span>
        li_list <span class="token operator">=</span> response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">&apos;.swatchElement&apos;</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> li <span class="token keyword">in</span> li_list<span class="token punctuation">:</span>
            <span class="token builtin">type</span> <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;.//span[@class=&quot;a-button-inner&quot;]/a/span/text()&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token builtin">type</span> <span class="token operator">==</span> <span class="token string">&apos;&#x7CBE;&#x88C5;&apos;</span> <span class="token operator">or</span> <span class="token builtin">type</span> <span class="token operator">==</span> <span class="token string">&apos;&#x5E73;&#x88C5;&apos;</span><span class="token punctuation">:</span>
                price <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;.//span[@class=&quot;a-button-inner&quot;]/a/span[2]/span/text()&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> price <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                    price <span class="token operator">=</span> price<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    price <span class="token operator">=</span> price<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&apos;&#xFFE5;&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;&apos;</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> name <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span> <span class="token operator">and</span> price <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            item <span class="token operator">=</span> BookItem<span class="token punctuation">(</span><span class="token punctuation">)</span>
            item<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> name
            item<span class="token punctuation">[</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> price
            <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
            <span class="token keyword">yield</span> item
        <span class="token keyword">pass</span>
</code></pre>
</div></div></div></sec>
<sec data-title="&#x56FE;&#x4E66;&#x9879;&#x76EE; &#x4E4B; &#x82CF;&#x5B81;&#x722C;&#x866B;" data-id="section04" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><h2>&#x56FE;&#x4E66;&#x9879;&#x76EE; &#x4E4B; &#x82CF;&#x5B81;&#x722C;&#x866B;<a class="pull-right section atTitle btn btn-default" target="section04"><span class="fa fa-angle-up"></span></a></h2></div><div class="panel-collapse in" id="section04"><div class="panel-body">
<h4 id="&#x5B9E;&#x73B0;&#x6D41;&#x7A0B;">&#x5B9E;&#x73B0;&#x6D41;&#x7A0B;</h4>
<ol>
<li>&#x5206;&#x7C7B; url &#x63D0;&#x53D6;</li>
<li>&#x83B7;&#x53D6;&#x5217;&#x8868;&#x9875;&#x83B7;&#x53D6;&#x8BE6;&#x60C5;&#x9875; url &#x63D0;&#x53D6;</li>
<li>&#x83B7;&#x53D6;&#x8BE6;&#x60C5;&#x9875;&#x63D0;&#x53D6; &#x540D;&#x79F0;&#x548C;&#x4EF7;&#x683C;<ol>
<li>&#x76F4;&#x63A5;&#x83B7;&#x53D6;&#x540D;&#x79F0;</li>
<li>&#x901A;&#x8FC7; js &#x9006;&#x5411;&#x6784;&#x9020;&#x4EF7;&#x683C; url &#x83B7;&#x53D6;&#x4EF7;&#x683C;</li>
</ol>
</li>
</ol>
<h4 id="&#x5B9E;&#x73B0;&#x4EE3;&#x7801;">&#x5B9E;&#x73B0;&#x4EE3;&#x7801;</h4>
<pre><code class="lang-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">import</span> scrapy

<span class="token triple-quoted-string string">&apos;&apos;&apos;
&#x660E;&#x786E;&#x722C;&#x53D6;&#x7684;&#x6D41;&#x7A0B;&#x601D;&#x8DEF;
&#x722C;&#x53D6;&#x5206;&#x7C7B;&#x9875; -&gt; &#x63D0;&#x53D6;&#x5217;&#x8868;&#x9875;url -&gt; &#x63D0;&#x53D6;&#x8BE6;&#x60C5;&#x9875;url -&gt; &#x5728;&#x8BE6;&#x60C5;&#x9875;&#x4E2D;&#x63D0;&#x53D6;&#x6240;&#x8981;&#x7684;&#x6570;&#x636E;

1. &#x722C;&#x53D6;&#x5206;&#x7C7B;&#x9875; 
&#x5206;&#x6790;:

&apos;&apos;&apos;</span>
<span class="token keyword">import</span> re
<span class="token keyword">from</span> book<span class="token punctuation">.</span>items <span class="token keyword">import</span> BookItem
<span class="token keyword">import</span> json
<span class="token keyword">import</span> jsonpath

<span class="token keyword">from</span> book<span class="token punctuation">.</span>settings <span class="token keyword">import</span> IS_DEVELOPMENT
<span class="token keyword">if</span> IS_DEVELOPMENT<span class="token punctuation">:</span>
    <span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>spiders <span class="token keyword">import</span> Spider
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">from</span> scrapy_redis<span class="token punctuation">.</span>spiders <span class="token keyword">import</span> RedisSpider <span class="token keyword">as</span> Spider

<span class="token keyword">class</span> <span class="token class-name">SuningSpider</span><span class="token punctuation">(</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">&apos;suning&apos;</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&apos;suning.com&apos;</span><span class="token punctuation">]</span>

    redis_key <span class="token operator">=</span> <span class="token string">&quot;book:suning:start_urls&quot;</span>

    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&apos;https://ipservice.suning.com/ipQuery.do&apos;</span><span class="token punctuation">]</span><span class="token comment">#[&apos;https://book.suning.com/&apos;]</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&apos;&apos;&apos;
        &#x89E3;&#x6790; ipquery&#x63A5;&#x53E3;
        :param response: 
        :return: 
        &apos;&apos;&apos;</span>
        ipquery <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

        <span class="token comment"># &#x5728;&#x8FDB;&#x884C;&#x5206;&#x7C7B;&#x9875;&#x9762;&#x8BBF;&#x95EE;</span>
        <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>
            url<span class="token operator">=</span><span class="token string">&quot;https://book.suning.com/&quot;</span><span class="token punctuation">,</span>
            callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_cates<span class="token punctuation">,</span>
            meta<span class="token operator">=</span><span class="token punctuation">{</span>
                <span class="token string">&quot;ipquery&quot;</span><span class="token punctuation">:</span>ipquery
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">parse_cates</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token comment"># &#x63D0;&#x53D6;&#x4E00;&#x7EA7;&#x5206;&#x7C7B;</span>
        cate_1_titles <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;//div[@class=&quot;menu-item&quot;]//h3/a/text()&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>

        div_list <span class="token operator">=</span> response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">&apos;.menu-sub&apos;</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> cate_1_title<span class="token punctuation">,</span>div <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>cate_1_titles<span class="token punctuation">,</span>div_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># &#x63D0;&#x53D6; 2 &#x7EA7;&#x5206;&#x7C7B;</span>
            cate_2_titles <span class="token operator">=</span> div<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;.//div[@class=&quot;submenu-left&quot;]/p/a/text()&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>

            ul_list <span class="token operator">=</span> div<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;.//div[@class=&quot;submenu-left&quot;]/ul&apos;</span><span class="token punctuation">)</span>

            <span class="token keyword">for</span> idx<span class="token punctuation">,</span>ul <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>ul_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
                cate_2_title <span class="token operator">=</span> <span class="token string">&apos;&#x6682;&#x65E0;&#x4E8C;&#x7EA7;&#x5206;&#x7C7B;&apos;</span>
                <span class="token keyword">if</span> idx <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>cate_2_titles<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    cate_2_title <span class="token operator">=</span> cate_2_titles<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>

                cate_3_titles <span class="token operator">=</span> ul<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;./li/a/text()&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>
                cate_3_hrefs <span class="token operator">=</span> ul<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;./li/a/@href&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">for</span> cate_3_title<span class="token punctuation">,</span>cate_3_href <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>cate_3_titles<span class="token punctuation">,</span>cate_3_hrefs<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>cate_1_title<span class="token punctuation">,</span><span class="token string">&apos;=&gt;&apos;</span><span class="token punctuation">,</span>cate_2_title<span class="token punctuation">,</span><span class="token string">&apos;=&gt;&apos;</span><span class="token punctuation">,</span>cate_3_title<span class="token punctuation">,</span><span class="token string">&apos;=&gt;&apos;</span><span class="token punctuation">,</span>cate_3_href<span class="token punctuation">)</span>
                    <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>
                        url<span class="token operator">=</span>cate_3_href<span class="token punctuation">,</span>
                        callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_list<span class="token punctuation">,</span>
                        meta<span class="token operator">=</span>response<span class="token punctuation">.</span>meta
                    <span class="token punctuation">)</span>


        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">parse_list</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&apos;&apos;&apos;
        &#x5206;&#x6790;

        &#x8BF7;&#x6C42;&#x6570;&#x636E;&#x5730;&#x5740;
            https://list.suning.com/emall/showProductList.do
        &#x8BF7;&#x6C42;&#x53C2;&#x6570;
        ci          &#x5217;&#x8868;&#x9875; url &#x5730;&#x5740;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x53C2;&#x6570;
        pg          03
        paging      0&#x662F;&#x4E0A;&#x534A;&#x9875;&#xFF0C;1&#x662F;&#x4E0B;&#x534A;&#x9875;
        cp          &#x9875;&#x6570; &#x4ECE; 0 &#x5F00;&#x59CB;

        # &#x63D0;&#x53D6;&#x8868;&#x793A;&#x4E00;&#x5171;&#x591A;&#x5C11;&#x9875;
        param.pageNumbers

        :param response: 
        :return: 
        &apos;&apos;&apos;</span>
        url <span class="token operator">=</span> <span class="token string">&quot;https://list.suning.com/emall/showProductList.do?ci={}&amp;pg={}&amp;paging={}&amp;cp={}&quot;</span>
        ci <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">&apos;-(.*?)-&apos;</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        pg <span class="token operator">=</span> <span class="token string">&apos;03&apos;</span>
        page_numbers <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">&apos;param.pageNumbers = &quot;(.*?)&quot;;&apos;</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> cp <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>page_numbers<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># &#x5217;&#x8868;&#x9875;&#x7684;&#x4E0A;&#x534A;&#x90E8;&#x5206;</span>
            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>
                url<span class="token operator">=</span>url<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ci<span class="token punctuation">,</span>pg<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>cp<span class="token punctuation">)</span><span class="token punctuation">,</span>
                callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_list_detail<span class="token punctuation">,</span>
                meta<span class="token operator">=</span>response<span class="token punctuation">.</span>meta
            <span class="token punctuation">)</span>


            <span class="token comment"># &#x5217;&#x8868;&#x9875;&#x7684;&#x4E0B;&#x534A;&#x90E8;&#x5206;</span>
            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>
                url<span class="token operator">=</span>url<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ci<span class="token punctuation">,</span> pg<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> cp<span class="token punctuation">)</span><span class="token punctuation">,</span>
                callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_list_detail<span class="token punctuation">,</span>
                meta<span class="token operator">=</span>response<span class="token punctuation">.</span>meta
            <span class="token punctuation">)</span>


        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">parse_list_detail</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>

        hrefs <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;//a[@class=&quot;sellPoint&quot;]/@href&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> href <span class="token keyword">in</span> hrefs<span class="token punctuation">:</span>

            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>
                url<span class="token operator">=</span><span class="token string">&quot;https:&quot;</span> <span class="token operator">+</span> href<span class="token punctuation">,</span>
                callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_detail<span class="token punctuation">,</span>
                meta<span class="token operator">=</span>response<span class="token punctuation">.</span>meta
            <span class="token punctuation">)</span>


        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">parse_detail</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&apos;&apos;&apos;
        &#x89E3;&#x6790;&#x8BE6;&#x60C5;&#x9875;
        :param response: 
        :return: 
        &apos;&apos;&apos;</span>

        ipquery <span class="token operator">=</span> response<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">&quot;ipquery&quot;</span><span class="token punctuation">]</span>

        item <span class="token operator">=</span> BookItem<span class="token punctuation">(</span><span class="token punctuation">)</span>
        name <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&apos;//h1[@id=&quot;itemDisplayName&quot;]/text()&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> name <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            item<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> name<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># &#x4EF7;&#x683C;&#x662F;js&#x6E32;&#x67D3;&#x7684;</span>
        <span class="token triple-quoted-string string">&apos;&apos;&apos;
        &#x5206;&#x6790;&#x4EF7;&#x683C; 
        url


        &apos;&apos;&apos;</span>

        luaUrl <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">&apos;&quot;luaUrl&quot;:&quot;(.*?)&quot;,&apos;</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        passPartNumber <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">&apos;&quot;passPartNumber&quot;:&quot;(.*?)&quot;,&apos;</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        partNumber <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">&apos;&quot;partNumber&quot;:&quot;(.*?)&quot;,&apos;</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        vendorCode <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">&apos;&quot;vendorCode&quot;:&quot;(.*?)&quot;,&apos;</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        provinceCode <span class="token operator">=</span> ipquery<span class="token punctuation">[</span><span class="token string">&quot;provinceCommerceId&quot;</span><span class="token punctuation">]</span>
        lesCityId <span class="token operator">=</span> ipquery<span class="token punctuation">[</span><span class="token string">&quot;cityLESId&quot;</span><span class="token punctuation">]</span>
        lesDistrictId <span class="token operator">=</span> ipquery<span class="token punctuation">[</span><span class="token string">&quot;districtLESId&quot;</span><span class="token punctuation">]</span>
        a <span class="token operator">=</span> lesCityId <span class="token operator">+</span> lesDistrictId <span class="token operator">+</span> <span class="token string">&quot;01&quot;</span><span class="token punctuation">;</span>
        category1 <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">&apos;&quot;category1&quot;:&quot;(.*?)&quot;,&apos;</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        mdmCityId <span class="token operator">=</span> ipquery<span class="token punctuation">[</span><span class="token string">&quot;cityMDMId&quot;</span><span class="token punctuation">]</span>
        cityId <span class="token operator">=</span> ipquery<span class="token punctuation">[</span><span class="token string">&quot;cityCommerceId&quot;</span><span class="token punctuation">]</span>
        districtId <span class="token operator">=</span> ipquery<span class="token punctuation">[</span><span class="token string">&quot;districtCommerceId&quot;</span><span class="token punctuation">]</span>
        cmmdtyType <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">&apos;&quot;cmmdtyType&quot;:&quot;(.*?)&quot;,&apos;</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        custLevel <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
        mountType <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">&apos;&quot;mountType&quot;:&quot;(.*?)&quot;,&apos;</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

        <span class="token keyword">if</span> mountType <span class="token operator">!=</span> <span class="token string">&apos;03&apos;</span><span class="token punctuation">:</span>
            b <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            b <span class="token operator">=</span> mountType

        catenIds <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">&apos;&quot;catenIds&quot;:&quot;(.*?)&quot;,&apos;</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        weight <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">&apos;&quot;weight&quot;:&quot;(.*?)&quot;,&apos;</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        e <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>

        price_url <span class="token operator">=</span> <span class="token string">&quot;https:&quot;</span> <span class="token operator">+</span> luaUrl <span class="token operator">+</span> <span class="token string">&quot;/nspcsale_0_&quot;</span> <span class="token operator">+</span> passPartNumber <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> partNumber <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> vendorCode <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> provinceCode <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> lesCityId <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> a <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> category1 <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> mdmCityId <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> cityId <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> districtId <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> cmmdtyType <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> custLevel <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> b <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> catenIds <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> weight <span class="token operator">+</span> <span class="token string">&quot;___&quot;</span> <span class="token operator">+</span> e <span class="token operator">+</span> <span class="token string">&quot;.html&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>
            url<span class="token operator">=</span>price_url<span class="token punctuation">,</span>
            callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_price<span class="token punctuation">,</span>
            meta <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;item&quot;</span><span class="token punctuation">:</span>item
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>

        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">parse_price</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        item <span class="token operator">=</span> response<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">&quot;item&quot;</span><span class="token punctuation">]</span>
        json_string <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">&apos;pcData\((.*)\)&apos;</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        price <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>json_string<span class="token punctuation">)</span>
        item<span class="token punctuation">[</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> jsonpath<span class="token punctuation">.</span>jsonpath<span class="token punctuation">(</span>price<span class="token punctuation">,</span><span class="token string">&apos;$..netPrice&apos;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">yield</span> item
</code></pre>
</div></div></div></sec>
<sec data-title="&#x603B;&#x7ED3;" data-id="sectionend" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><h2>&#x603B;&#x7ED3;<a class="pull-right section atTitle btn btn-default" target="sectionend"><span class="fa fa-angle-up"></span></a></h2></div><div class="panel-collapse in" id="sectionend"><div class="panel-body">
</div></div></div></sec></body></html>
                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../scrapy框架/scrapy项目部署.html" class="navigation navigation-prev " aria-label="Previous page: scrapy 项目部署"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../附录/附录.html" class="navigation navigation-next " aria-label="Next page: 附录"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-splitter/splitter.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

    
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sectionx/sectionx.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-ace/ace/ace.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-ace/ace.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-toggle-chapters/toggle.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"expandable-chapters-small":{},"fontsettings":{"theme":"white","family":"sans","size":2},"prism":{"css":["prismjs/themes/prism-solarizedlight.css"],"lang":{"flow":"typescript"},"ignore":["mermaid","eval-js"],"sectionx":{"tag":"b"},"include-codeblock":{"template":"ace","unindent":true,"theme":"monokai"}},"splitter":{},"mermaid":{},"sectionx":{},"include-codeblock":{"check":false,"edit":false,"lang":"","fixlang":false,"template":"default","theme":"chrome","unindent":false},"ace":{},"emphasize":{},"toggle-chapters":{},"codeblock-filename":{}};
    gitbook.start(config);
});
</script>

        <!-- body:end -->
    </body>
    <!-- End of book 爬虫课程 -->
</html>
